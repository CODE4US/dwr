<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Simple Text Generation Demo</title>
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />
  <script type='text/javascript' src='../dwr/engine.js'> </script>
  <script type='text/javascript' src='../dwr/util.js'> </script>
  <script type='text/javascript' src='../dwr/interface/Demo.js'> </script>
  <script type="text/javascript" src='index.js'> </script>
  <link rel="stylesheet" type="text/css" href="../generic.css" />
</head>
<body onload="DWRUtil.useLoadingMessage();">
<div id="page-title">[
  <a href="http://getahead.ltd.uk/dwr/">DWR Website</a> |
  <a href="..">Web Application Index</a>
]</div>

<h1>Dynamically Updating Text</h1>

<p>This is a simple demonstration of how to dynamically update a web-page with
text fetched from a web server.</p>

<h2>Demo</h2>

<p>
  Name:
  <input type="text" id="demoName"/>
  <input value="Send" type="button" onclick="update()"/>
  <br/>
  Reply: <span id="demoReply" style="background:#eeffdd; padding-left:4px; padding-right:4px;"></span>
</p>

<h2>How it works</h2>
<p>When you click on the "Send" button the browser calls on-click event, which
calls the <code>update()</code> function:</p>

<pre>
function update() {
  var name = DWRUtil.getValue("demoName");
  Demo.sayHello(name, loadinfo);
}
</pre>

<p>DWR is asynchronous due to the way Javascript works so it won't halt the web
browser while we are waiting for the background HTTP request to return.
So the parameter <code>loadinfo</code> names a function to be called when the
call has returned.</p>

<p>On the server, DWR calls the <code>Demo.sayHello()</code> Java method:</p>

<pre>
public String sayHello(String name) {
    return "Hello, " + name;
}
</pre>

<p>When this method returns, DWR calls <code>loadinfo()</code> function which
moves the text to the reply span:</p>

<pre>
function loadinfo(data) {
  DWRUtil.setValue("demoReply", data);
}
</pre>

<p><code>DWRUtil.setValue()</code> is a utility that takes the data you pass in
the second parameter and works out how to fit it to go into the HTML element
specified by id in the first parameter. This function is one of several neat
Javascript utilities that make working with DWR much easier.</p>

<p>We could simplify things by writing the 2 Javascript functions together like
this:</p>

<pre>
function update() {
  var name = DWRUtil.getValue("demoName");
  Demo.sayHello(name, function(data) {
    DWRUtil.setValue("demoReply", data);
  });
}
</pre>

<p>And that's it. In effect we have written much less than 10 lines of code to
get data from the server, and display it in the browser.</p>

<h2>Resource Forward Demo</h2>

<p><input value="Include Page" type="button" onclick="forward()"/><br/>
Included Page:</p>

<div id="forward"></div>

<h2>How it works</h2>

<p>Normally the code called by DWR is a simple POJO that knows nothing about
the web. In this demonstration we want to find out about the web server so we
use the <code>WebContext</code> class to get access to the ServletContext.</p>

<p>This example is very similar, the only difference is that we are using the
contents of <a href="forward.html">this HTML page</a>, and using the WebContext
class to allow us to get data from other pages. There are no iframes used in
this example - just DWR and a humble div.</p>

<p>The code is similar to the above example except for different Java code:</p>

<pre>
public String getInclude() {
    WebContext wctx = WebContextFactory.get();
    return wctx.forwardToString("/simpletext/forward.html");
}
</pre>

</body>
</html>
