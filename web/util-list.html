<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <title>DWR - util.js - Generating Lists</title>
  <script type='text/javascript' src='/dwr/dwr/util.js'></script>
  <script type="text/javascript">
function objectEval(text)
{
    // eval() breaks when we use it to get an object using the { a:42, b:'x' }
    // syntax because it thinks that { and } surround a block and not an object
    // So we wrap it in an array and extract the first element to get around
    // this.
    // The regex = [start of line][whitespace]{[stuff]}[whitespace][end of line]
    text = text.replace(/\n/g, " ");
    text = text.replace(/\r/g, " ");
    if (text.match(/^\s*\{.*\}\s*$/))
    {
        text = "[" + text + "][0]";
    }

    return eval(text);
}
  </script>
</head>

<body>

<h1>util.js: Generating Lists</h1>

<p>
A common task with DWR is to fill a select list with options. A common example
would be providing options based on an earlier input.
</p>

<h3>Simple Array Example</h3>

<p>
DWR provides the <code>DWRUtil.addOptions()</code> function to add to a select
list. At it's most simple this takes 2 parameters, the first being the id of a
select element to alter, and the second being an array of strings, each of which
is to be used as an option.
</p>

<p>
DWR also provides the <code>DWRUtil.removeAllOptions()</code> function which
empties the select element. Separating the 2 functions means that we can better
handle default values.
</p>

<p>
<code>DWRUtil.addOptions( "demo1", 
  <input id="simple" type="text" value="[ 'Africa', 'America', 'Asia', 'Australasia', 'Europe' ]" size="50"/>
)</code>
<input type="button" onclick="DWRUtil.addOptions('demo1', eval($('simple').value));" value="Show Me"/>
</p>

<p>
A list with <code>id="demo1"</code>: <select id="demo1"></select>
<input type="button" onclick="DWRUtil.removeAllOptions('demo1')" value="DWRUtil.removeAllOptions('demo1')"/>
</p>

<h3>Simple Object Array Example</h3>

<p>
You may wish to fill a select list from an array of beans rather than
an array of strings. In this case you need to specify the property from the
bean that will be used for each value.
</p>

<p>
<code>DWRUtil.addOptions( "demo2", 
  <textarea id="oadata" rows="6" cols="45" style="vertical-align:top;" >[
  { name:'Africa', population:'800m' },
  { name:'America', population:'900m' },
  { name:'Asia', population:'3000m' },
  { name:'Australasia', population:'31m' },
  { name:'Europe', population:'700m' }
]</textarea>,
<input id="oavalueprop" value="name"/>
)</code>
<input type="button" onclick="DWRUtil.addOptions('demo2', eval($('oadata').value), $('oavalueprop').value);" value="Show Me"/>
</p>

<p>
A list with <code>id="demo2"</code>: <select id="demo2"></select>
<input type="button" onclick="DWRUtil.removeAllOptions('demo2')" value="DWRUtil.removeAllOptions('demo2')"/>
</p>

<h3>Advanced Object Array Example</h3>

<p>
Alternatively you need to specify differing values (as are submitted by a form or
read by DWRUtil.getValue() and display texts. There is an optional 4th parameter
that allows you to specify data to be used as the text separately from the
value.
</p>

<p>
<code>DWRUtil.addOptions( "demo3", 
  <textarea id="aadata" rows="6" cols="35" style="vertical-align:top;" >[
  { name:'Africa', id:'AF' },
  { name:'America', id:'AM' },
  { name:'Asia', id:'AS' },
  { name:'Australasia', id:'AU' },
  { name:'Europe', id:'EU' }
]</textarea>,
<input id="aavalueprop" value="id" size="4"/>,
<input id="aatextprop" value="name" size="10"/>
)</code>
<input type="button" onclick="DWRUtil.addOptions('demo3', eval($('aadata').value), $('aavalueprop').value, $('aatextprop').value);" value="Show Me"/>
</p>

<p>
A list with <code>id="demo3"</code>: <select id="demo3"></select>
<input type="button" onclick="DWRUtil.removeAllOptions('demo3')" value="DWRUtil.removeAllOptions('demo3')"/>
</p>

<h3>Map Example</h3>

<p>
Sometimes you need fill a select list using a map, filling the values from the
map keys and the text from the map values. Or you may wish to do it the other
way around. The <code>DWRUtil.addOptions()</code> function will handle these
options too.
</p>

<p>
<code>DWRUtil.addOptions( "demo4", 
  <textarea id="mapdata" rows="6" cols="35" style="vertical-align:top;" >{
  AF:'Africa',
  AM:'America', id:'AM',
  AS:'Asia', id:'AS',
  AS:'Australasia', id:'AU',
  EU:'Europe'
}</textarea>
)</code>
<input type="button" onclick="DWRUtil.addOptions('demo4', objectEval($('mapdata').value));" value="Show Me"/>
</p>

<p>
A list with <code>id="demo3"</code>: <select id="demo4"></select>
<input type="button" onclick="DWRUtil.removeAllOptions('demo4')" value="DWRUtil.removeAllOptions('demo4')"/>
</p>

</body>
</html>
